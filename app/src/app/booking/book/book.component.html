<section class="book-hero text-white">
  <div class="container py-5">
    <h1 class="display-6 fw-bold mb-1">Book your experience</h1>
    <p class="mb-0 text-white-50">Tell us what you have in mind — we’ll tailor it to your group.</p>
  </div>
</section>

<main class="py-5">
  <div class="container">
    <form [formGroup]="form" (ngSubmit)="submit()" novalidate class="row g-4">
      <!-- LEFT: form -->
      <div class="col-lg-8">
        <div class="card border-0 shadow-sm">
          <div class="card-body">
            <!-- Event type -->
            <div class="mb-4">
              <label class="form-label fw-semibold">Event type</label>
              <div class="row g-2">
                <div class="col-md-6">
                  <select class="form-select" formControlName="eventType">
                    <option value="">Select…</option>
                    <option *ngFor="let e of eventTypes" [value]="e.value">{{ e.label }}</option>
                    <option value="other">Other (describe)</option>
                  </select>
                  <div class="invalid-feedback d-block" *ngIf="showError('eventType')">
                    Please select an event type.
                  </div>
                </div>
                <div class="col-md-6" *ngIf="form.value.eventType === 'other'">
                  <input type="text" class="form-control" placeholder="Describe your event"
                         formControlName="eventTypeOther">
                  <div class="invalid-feedback d-block" *ngIf="showError('eventTypeOther')">
                    Tell us a bit about your event.
                  </div>
                </div>
              </div>
            </div>

            <!-- Date & time -->
            <div class="mb-4">
              <label class="form-label fw-semibold">Date & time</label>
              <div class="row g-2">
                <div class="col-md-4">
                  <input type="date" class="form-control" formControlName="date">
                  <div class="invalid-feedback d-block" *ngIf="showError('date')">
                    Please pick a date.
                  </div>
                </div>
                <div class="col-md-4">
                  <input type="time" class="form-control" formControlName="time">
                  <div class="form-text">Approximate start time</div>
                </div>
                <div class="col-md-4">
                  <select class="form-select" formControlName="duration">
                    <option *ngFor="let d of durations" [value]="d">{{ d }}</option>
                  </select>
                  <div class="form-text">Planned duration</div>
                </div>
              </div>
            </div>

            <!-- Group -->
            <div class="mb-4">
              <label class="form-label fw-semibold">Group size</label>
              <div class="row g-2">
                <div class="col-md-4">
                  <input type="number" class="form-control" min="1" max="12" formControlName="people"
                         placeholder="e.g. 6">
                  <div class="invalid-feedback d-block" *ngIf="showError('people')">
                    How many people are coming?
                  </div>
                </div>
                <div class="col-md-8">
                  <input type="text" class="form-control" formControlName="groupNote"
                         placeholder="Occasion (birthday, proposal, team, EVJF/EVG…)">
                </div>
              </div>
            </div>

            <!-- Special services -->
            <div class="mb-4">
              <label class="form-label fw-semibold">Special services</label>
              <div class="row g-2">
                <div class="col-6 col-md-4" *ngFor="let s of services">
                  <div class="form-check">
                    <input class="form-check-input" type="checkbox"
                           [id]="s.key" (change)="toggleService(s.key, $event.target.checked)"
                           [checked]="form.value.specialServices[s.key]">
                    <label class="form-check-label" [for]="s.key">
                      <i [class]="s.icon + ' me-1'"></i>{{ s.label }}
                    </label>
                  </div>
                </div>
              </div>

              <!-- Service details (optional) -->
              <div class="mt-3">
                <textarea rows="3" class="form-control" formControlName="servicesNote"
                          placeholder="Any details for food preferences, yoga level, transfers (pickup point), music style…"></textarea>
              </div>
            </div>

            <!-- Comments -->
            <div class="mb-4">
              <label class="form-label fw-semibold">Comments</label>
              <textarea rows="4" class="form-control" formControlName="comments"
                        placeholder="Anything else we should know?"></textarea>
            </div>

            <!-- Contact info (shown if guest/anonymous) -->
            <div class="mb-2" *ngIf="collectContact">
              <label class="form-label fw-semibold">Your contact details</label>
              <div class="row g-2">
                <div class="col-md-4">
                  <input class="form-control" placeholder="First name" formControlName="firstName">
                  <div class="invalid-feedback d-block" *ngIf="showError('firstName')">
                    First name is required.
                  </div>
                </div>
                <div class="col-md-4">
                  <input class="form-control" placeholder="Last name" formControlName="lastName">
                  <div class="invalid-feedback d-block" *ngIf="showError('lastName')">
                    Last name is required.
                  </div>
                </div>
                <div class="col-md-4">
                  <input type="tel" class="form-control" placeholder="+33 6…" formControlName="phone">
                </div>
                <div class="col-md-8">
                  <input type="email" class="form-control" placeholder="email@example.com" formControlName="email">
                  <div class="invalid-feedback d-block" *ngIf="showError('email')">
                    Valid email is required.
                  </div>
                </div>
              </div>
            </div>

          </div>
          <div class="card-footer bg-white border-0 d-flex justify-content-end gap-2">
            <button type="button" class="btn btn-outline-secondary rounded-pill" routerLink="/tours">Cancel</button>
            <button class="btn btn-dark rounded-pill" [disabled]="submitting || form.invalid">
              {{ submitting ? 'Sending…' : 'Request booking' }}
            </button>
          </div>
        </div>

        <!-- Alerts -->
        <div class="alert alert-success mt-3" *ngIf="ok">Thanks! We’ll get back to you shortly.</div>
        <div class="alert alert-danger mt-3" *ngIf="error">{{ error }}</div>
      </div>

      <!-- RIGHT: summary -->
      <aside class="col-lg-4">
        <div class="card border-0 shadow-sm">
          <div class="card-body">
            <h5 class="card-title">Summary</h5>
            <ul class="list-unstyled small text-muted mb-0">
              <li class="mb-1"><i class="bi bi-calendar-event me-1"></i> {{ form.value.date || '—' }} • {{ form.value.time || '—' }}</li>
              <li class="mb-1"><i class="bi bi-people me-1"></i> {{ form.value.people || 1 }} people</li>
              <li class="mb-1"><i class="bi bi-compass me-1"></i>
                {{ displayEventType(form.value.eventType, form.value.eventTypeOther) }}
              </li>
              <li class="mb-1"><i class="bi bi-clock me-1"></i> {{ form.value.duration }}</li>
            </ul>

            <hr>
            <div class="small text-muted mb-2">Requested services</div>
            <div class="d-flex flex-wrap gap-1">
              <span class="badge text-bg-light border" *ngFor="let tag of selectedServiceLabels">{{ tag }}</span>
              <span class="text-muted small" *ngIf="!selectedServiceLabels.length">None</span>
            </div>

            <hr>
            <div class="d-flex justify-content-between align-items-center">
              <div class="small text-muted">Est. base from</div>
              <div class="fw-bold">€{{ estimateFrom }}</div>
            </div>
            <div class="form-text mt-1">Final quote depends on date, season & options.</div>
          </div>
        </div>
      </aside>
    </form>
  </div>
</main>
