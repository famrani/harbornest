{"version":3,"file":"src_app_profile_profile_module_ts.js","mappings":";;;;;;;;;;;;;;;;;;;;;;;;AAAA;AACyC;AACM;AACF;AACqB;AACxB;AAE2B;AACkB;AAEtC;AAEc;AAcxD,IAAMU,aAAa,GAAnB,MAAMA,aAAa,GAAI;AAAjBA,aAAa,GAAAC,iDAAA,EAZzBX,uDAAQ,CAAC;EACRY,YAAY,EAAE,CAACN,8EAAkB,EAAEC,gGAAoB,CAAC;EACxDM,OAAO,EAAE,CACPZ,yDAAY,EACZC,uDAAW,EACXO,wEAAoB,EACpBN,uDAAW,EAAEC,+DAAmB,EAChCC,oDAAY,CAACS,OAAO,EAAE,EACtBN,2DAAgB,CACjB;EACDO,SAAS,EAAC;CACX,CAAC,GACWL,aAAa,CAAI;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AC1BuB;AACe;AAEvB;AAMtC,IAAMJ,kBAAkB,GAAxB,MAAMA,kBAAkB;EAUTc,EAAA;EAAyBC,KAAA;EAT7CC,OAAO,GAAG,KAAK;EACfC,OAAO,GAAG,KAAK;EACfC,KAAK;EACLC,IAAI;EAEIC,GAAG;EACHC,GAAG;EACHC,KAAK;EAEbC,YAAoBT,EAAe,EAAUC,KAAmB;IAA5C,KAAAD,EAAE,GAAFA,EAAE;IAAuB,KAAAC,KAAK,GAALA,KAAK;IAChD;IACA,IAAI,CAACK,GAAG,GAAG,IAAI,CAACL,KAAK,CAACS,UAAU,CAACC,SAAS,CAACC,CAAC,IAAG;MAC7C,IAAI,CAACL,GAAG,GAAGK,CAAC,EAAEL,GAAG,IAAIM,SAAS;MAC9B,IAAI,CAACL,KAAK,GAAGI,CAAC,EAAEJ,KAAK,IAAIK,SAAS;IACpC,CAAC,CAAC;IACF,IAAI,CAACR,IAAI,GAAG,IAAI,CAACL,EAAE,CAACc,KAAK,CAAC;MACxBC,WAAW,EAAE,CAAC,EAAE,EAAE,CAACjB,sDAAU,CAACkB,QAAQ,EAAElB,sDAAU,CAACmB,SAAS,CAAC,CAAC,CAAC,CAAC,CAAC;MACjEC,WAAW,EAAE,CAAC,EAAE,EAAE,CAACpB,sDAAU,CAACkB,QAAQ,EAAElB,sDAAU,CAACmB,SAAS,CAAC,CAAC,CAAC,CAAC,CAAC;MACjEE,OAAO,EAAE,CAAC,EAAE,EAAE,CAACrB,sDAAU,CAACkB,QAAQ,CAAC;KACpC,CAAC;EAGJ;EAEAI,WAAWA,CAAA;IAAW,IAAI,CAACd,GAAG,EAAEe,WAAW,EAAE;EAAE;EAEzCC,MAAMA,CAAA;IAAA,IAAAC,KAAA;IAAA,OAAAC,oJAAA;MACVD,KAAI,CAACnB,KAAK,GAAGS,SAAS;MACtBU,KAAI,CAACpB,OAAO,GAAG,KAAK;MACpB,IAAIoB,KAAI,CAAClB,IAAI,CAACoB,OAAO,EAAE;MAEvB,MAAM;QAAEV,WAAW;QAAEG,WAAW;QAAEC;MAAO,CAAE,GAAGI,KAAI,CAAClB,IAAI,CAACqB,KAAK;MAC7D,IAAIR,WAAW,KAAKC,OAAO,EAAE;QAC3BI,KAAI,CAACnB,KAAK,GAAG,6BAA6B;QAC1C;MACF;MACA,IAAI,CAACmB,KAAI,CAAChB,GAAG,IAAI,CAACgB,KAAI,CAACf,KAAK,EAAE;QAC5Be,KAAI,CAACnB,KAAK,GAAG,gDAAgD;QAC7D;MACF;MAEA;MACA,MAAMuB,MAAM,GAAG;QAAEC,MAAM,EAAEL,KAAI,CAAChB,GAAG;QAAEC,KAAK,EAAEe,KAAI,CAACf;MAAK,CAAS;MAE7De,KAAI,CAACrB,OAAO,GAAG,IAAI;MACnB,IAAI;QACF,MAAMqB,KAAI,CAACtB,KAAK,CAAC4B,6BAA6B,CAACd,WAAY,EAAEG,WAAY,CAAC;QAC1EK,KAAI,CAACpB,OAAO,GAAG,IAAI;QACnBoB,KAAI,CAAClB,IAAI,CAACyB,KAAK,EAAE;MACnB,CAAC,CAAC,OAAOC,CAAM,EAAE;QACfR,KAAI,CAACnB,KAAK,GAAG2B,CAAC,EAAEC,OAAO,IAAI,4BAA4B;MACzD,CAAC,SAAS;QACRT,KAAI,CAACrB,OAAO,GAAG,KAAK;MACtB;IAAC;EACH;EAEA,IAAI+B,CAACA,CAAA;IAAK,OAAO,IAAI,CAAC5B,IAAI,CAAC6B,QAAQ;EAAE;;;;;;;AAzD1BhD,kBAAkB,GAAAK,iDAAA,EAJ9BK,wDAAS,CAAC;EACTuC,QAAQ,EAAE,eAAe;EACzBC,QAAA,EAAAC,iEAAAA;CACD,CAAC,GACWnD,kBAAkB,CA0D9B;;;;;;;;;;;;;;;;;;;;;ACjEwC;AACc;AAEc;AACkB;AAEvF,MAAMqD,MAAM,GAAW,CACrB;EAAEC,IAAI,EAAE,WAAW;EAAEC,SAAS,EAAEvD,8EAAkBA;AAAA,CAAE,EACpD;EAAEsD,IAAI,EAAE,cAAc;EAAEC,SAAS,EAAEtD,gGAAoBA;AAAA,CAAE,CAC1D;AAQM,IAAME,oBAAoB,GAA1B,MAAMA,oBAAoB,GAAI;AAAxBA,oBAAoB,GAAAE,iDAAA,EANhCX,uDAAQ,CAAC;EACRa,OAAO,EAAE,CACP6C,yDAAY,CAACI,QAAQ,CAACH,MAAM,CAAC,CAC9B;EACDI,OAAO,EAAE,CAACL,yDAAY;CACvB,CAAC,GACWjD,oBAAoB,CAAI;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;ACnBgB;AAC0B;AAEpB;AACd;AACA;AA2BtC,IAAMF,oBAAoB,GAA1B,MAAMA,oBAAoB;EAcjBa,EAAA;EACAC,KAAA;EACA8C,OAAA;EACDC,OAAA;EAhBXC,OAAO,GAAG,IAAI;EACdC,MAAM,GAAG,KAAK;EACd9C,KAAK;EACLD,OAAO,GAAG,KAAK;EACfE,IAAI;EAEJE,GAAG;EACH4C,OAAO;EACP7C,GAAG;EAEH8C,SAAS,GAAa,EAAE;EAExB3C,YACYT,EAAe,EACfC,KAAmB,EACnB8C,OAAuB,EACxBC,OAAqB;IAAA,IAAAzB,KAAA;IAHpB,KAAAvB,EAAE,GAAFA,EAAE;IACF,KAAAC,KAAK,GAALA,KAAK;IACL,KAAA8C,OAAO,GAAPA,OAAO;IACR,KAAAC,OAAO,GAAPA,OAAO;IAEd,IAAI,CAAC1C,GAAG,GAAG,IAAI,CAACL,KAAK,CAACS,UAAU,CAACC,SAAS;MAAA,IAAA0C,IAAA,GAAA7B,oJAAA,CAAC,WAAMZ,CAAC,EAAG;QACjDW,KAAI,CAAChB,GAAG,GAAGK,CAAC,EAAEL,GAAG,IAAIM,SAAS;QAC9B,IAAI,CAACU,KAAI,CAAChB,GAAG,EAAE;UACXgB,KAAI,CAAC0B,OAAO,GAAG,KAAK;UACpB;QACJ;QACA,MAAM1B,KAAI,CAAC+B,WAAW,EAAE;MAC5B,CAAC;MAAA,iBAAAC,EAAA;QAAA,OAAAF,IAAA,CAAAG,KAAA,OAAAC,SAAA;MAAA;IAAA,IAAC;IACF,IAAI,CAACpD,IAAI,GAAG,IAAI,CAACL,EAAE,CAACc,KAAK,CAAC;MACtB4C,SAAS,EAAE,CAAC,EAAE,EAAE5D,sDAAU,CAACkB,QAAQ,CAAC;MACpC2C,QAAQ,EAAE,CAAC,EAAE,EAAE7D,sDAAU,CAACkB,QAAQ,CAAC;MACnC4C,WAAW,EAAE,CAAC,EAAE,CAAC;MACjBC,KAAK,EAAE,CAAC,EAAE,CAAC;MACXC,OAAO,EAAE,CAAC,EAAE,CAAC;MACb;MACAC,IAAI,EAAE,CAAC;QAAErC,KAAK,EAAE,UAAU;QAAEsC,QAAQ,EAAE;MAAI,CAAE,CAAC;MAC7CC,KAAK,EAAE,CAAC,QAAQ,CAAC;MAAE;MACnBC,aAAa,EAAE,IAAI,CAAClE,EAAE,CAACmE,KAAK,CAAC,EAAS;KACzC,CAAC;EAGN;EAEA/C,WAAWA,CAAA;IAAW,IAAI,CAACd,GAAG,EAAEe,WAAW,EAAE;EAAE;EAE/C,IAAI+C,OAAOA,CAAA;IAAK,OAAO,IAAI,CAAC/D,IAAI,CAACgE,GAAG,CAAC,eAAe,CAAc;EAAE;EACpEC,SAASA,CAACC,KAAK,GAAG,EAAE,EAAEC,GAAG,GAAG,EAAE;IAAI,OAAO,IAAI,CAACxE,EAAE,CAACc,KAAK,CAAC;MAAEyD,KAAK,EAAE,CAACA,KAAK,CAAC;MAAEC,GAAG,EAAE,CAACA,GAAG;IAAC,CAAE,CAAC;EAAE;EAE1ElB,WAAWA,CAAA;IAAA,IAAAmB,MAAA;IAAA,OAAAjD,oJAAA;MACrBiD,MAAI,CAACxB,OAAO,GAAG,IAAI;MACnBwB,MAAI,CAACrE,KAAK,GAAGS,SAAS;MACtB,IAAI;QACA,MAAM6D,GAAG,SAASD,MAAI,CAAC1B,OAAO,CAAC4B,SAAS,CACpCF,MAAI,CAACzB,OAAO,CAAC4B,gBAAgB,EAC7BH,MAAI,CAACzB,OAAO,CAAC6B,GAAG,EAChBhC,qDAAU,CAACiC,OAAO,EAClBL,MAAI,CAAClE,GAAG,CACU;QAEtBkE,MAAI,CAACtB,OAAO,GAAGuB,GAAG,IAAI7D,SAAS;QAE/B4D,MAAI,CAACpE,IAAI,CAACyB,KAAK,CAAC;UACZ4B,SAAS,EAAEgB,GAAG,EAAEhB,SAAS,IAAI,EAAE;UAC/BC,QAAQ,EAAEe,GAAG,EAAEf,QAAQ,IAAI,EAAE;UAC7BC,WAAW,EAAEc,GAAG,EAAEd,WAAW,IAAI,EAAE;UACnCC,KAAK,EAAEa,GAAG,EAAEb,KAAK,IAAI,EAAE;UACvBC,OAAO,EAAEY,GAAG,EAAEZ,OAAO,IAAI,EAAE;UAC3BC,IAAI,EAAE,UAAU;UAChBE,KAAK,EAAES,GAAG,EAAET,KAAK,IAAI;SACxB,CAAC;QAEF;QACAQ,MAAI,CAACL,OAAO,CAACW,KAAK,EAAE;QACpB,CAACL,GAAG,EAAER,aAAa,IAAI,EAAE,EAAEc,OAAO,CAACC,CAAC,IAAIR,MAAI,CAACL,OAAO,CAACc,IAAI,CAACT,MAAI,CAACH,SAAS,CAACW,CAAC,CAACV,KAAK,EAAEU,CAAC,CAACT,GAAG,CAAC,CAAC,CAAC;QAE1F;QACAC,MAAI,CAACrB,SAAS,GAAG,CAACsB,GAAG,EAAES,MAAM,IAAI,EAAE,EAAEC,KAAK,EAAE;QAE5CX,MAAI,CAACxB,OAAO,GAAG,KAAK;MACxB,CAAC,CAAC,OAAOlB,CAAM,EAAE;QACb0C,MAAI,CAACrE,KAAK,GAAG2B,CAAC,EAAEC,OAAO,IAAI,wBAAwB;QACnDyC,MAAI,CAACxB,OAAO,GAAG,KAAK;MACxB;IAAC;EACL;EAEAoC,SAASA,CAAA;IAAK,IAAI,CAACjB,OAAO,CAACc,IAAI,CAAC,IAAI,CAACZ,SAAS,EAAE,CAAC;EAAE;EACnDgB,YAAYA,CAACC,CAAS;IAAI,IAAI,CAACnB,OAAO,CAACoB,QAAQ,CAACD,CAAC,CAAC;EAAE;EAE9CE,gBAAgBA,CAACC,KAAsB;IAAA,IAAAC,MAAA;IAAA,OAAAnE,oJAAA;MACzC,IAAI,CAACkE,KAAK,EAAEE,MAAM,EAAE;MACpB,IAAI,CAACD,MAAI,CAACpF,GAAG,EAAE;MACfoF,MAAI,CAACzC,MAAM,GAAG,IAAI;MAClB,IAAI;QACA,MAAM2C,GAAG,GAAG,SAASF,MAAI,CAACpF,GAAG,EAAE;QAC/B,KAAK,MAAMuF,IAAI,IAAIC,KAAK,CAACC,IAAI,CAACN,KAAK,CAAC,EAAE;UAClC,MAAMlB,GAAG,SAASmB,MAAI,CAAC5C,OAAO,CAACkD,cAAc,CAACN,MAAI,CAAC3C,OAAO,CAAC4B,gBAAgB,EAAEkB,IAAI,EAAED,GAAG,CAAW;UACjGF,MAAI,CAACvC,SAAS,CAAC8B,IAAI,CAACV,GAAG,CAAC;QAC5B;MACJ,CAAC,CAAC,OAAOzC,CAAM,EAAE;QACb4D,MAAI,CAACvF,KAAK,GAAG2B,CAAC,EAAEC,OAAO,IAAI,qBAAqB;MACpD,CAAC,SAAS;QACN2D,MAAI,CAACzC,MAAM,GAAG,KAAK;MACvB;IAAC;EACL;EAEMgD,IAAIA,CAAA;IAAA,IAAAC,MAAA;IAAA,OAAA3E,oJAAA;MACN2E,MAAI,CAAC/F,KAAK,GAAGS,SAAS;MACtBsF,MAAI,CAAChG,OAAO,GAAG,KAAK;MACpB,IAAI,CAACgG,MAAI,CAAC5F,GAAG,EAAE;MAEf4F,MAAI,CAACjD,MAAM,GAAG,IAAI;MAClB,IAAI;QACA,MAAMkD,CAAC,GAAGD,MAAI,CAAC9F,IAAI,CAACqB,KAAK;QACzB,MAAM2E,GAAG,GAAGC,IAAI,CAACD,GAAG,EAAE;QAEtB;QACA,MAAME,IAAI,GAAwBJ,MAAI,CAAChD,OAAO,IAAI;UAAEvB,MAAM,EAAEuE,MAAI,CAAC5F,GAAG;UAAEC,KAAK,EAAE;QAAE,CAAS;QAExF,MAAMgG,OAAO,GAAe;UACxB5E,MAAM,EAAEuE,MAAI,CAAC5F,GAAG;UAChBC,KAAK,EAAE+F,IAAI,CAAC/F,KAAK,IAAI,EAAE;UAEvBkD,SAAS,EAAE0C,CAAC,CAAC1C,SAAS,IAAI,EAAE;UAC5BC,QAAQ,EAAEyC,CAAC,CAACzC,QAAQ,IAAI,EAAE;UAC1BC,WAAW,EAAEwC,CAAC,CAACxC,WAAW,IAAI,EAAE;UAChCC,KAAK,EAAEuC,CAAC,CAACvC,KAAK,IAAI,EAAE;UACpBC,OAAO,EAAEsC,CAAC,CAACtC,OAAO,IAAI,EAAE;UAExB;UACAC,IAAI,EAAE,UAAU;UAEhBoB,MAAM,EAAEgB,MAAI,CAAC/C,SAAS;UACtBqD,QAAQ,EAAEN,MAAI,CAAC/C,SAAS,CAAC,CAAC,CAAC,IAAImD,IAAI,CAACE,QAAQ,IAAI,EAAE;UAElDvC,aAAa,EAAE,CAACkC,CAAC,CAAClC,aAAa,IAAI,EAAE,EAAEwC,GAAG,CAAEzB,CAAM,KAAM;YAAEV,KAAK,EAAEU,CAAC,CAACV,KAAK,IAAI,EAAE;YAAEC,GAAG,EAAES,CAAC,CAACT,GAAG,IAAI;UAAE,CAAE,CAAC,CAAC;UAEpG;UACAmC,aAAa,EAAEJ,IAAI,CAACI,aAAa,IAAI,KAAK;UAC1CC,QAAQ,EAAEL,IAAI,CAACK,QAAQ,IAAI,UAAU;UAErC;UACA3C,KAAK,EAAGmC,CAAC,CAACnC,KAAa,IAAIsC,IAAI,CAACtC,KAAK,IAAI,QAAQ;UAEjD;UACA4C,eAAe,EAAEN,IAAI,CAACM,eAAe,IAAI,EAAE;UAC3CC,mBAAmB,EAAEP,IAAI,CAACO,mBAAmB,IAAI,EAAE;UAEnDC,SAAS,EAAER,IAAI,CAACQ,SAAS,IAAIV,GAAG;UAChCW,UAAU,EAAEX;SACf;QAED,MAAMF,MAAI,CAACpD,OAAO,CAACkE,YAAY,CAC3Bd,MAAI,CAACnD,OAAO,CAAC4B,gBAAgB,EAC7BuB,MAAI,CAACnD,OAAO,CAAC6B,GAAG,EAChBhC,qDAAU,CAACiC,OAAO,EAClB0B,OAAO,EACPL,MAAI,CAAC5F,GAAG,CACX;QAED4F,MAAI,CAAChD,OAAO,GAAGqD,OAAO;QACtBL,MAAI,CAAChG,OAAO,GAAG,IAAI;MACvB,CAAC,CAAC,OAAO4B,CAAM,EAAE;QACboE,MAAI,CAAC/F,KAAK,GAAG2B,CAAC,EAAEC,OAAO,IAAI,wBAAwB;MACvD,CAAC,SAAS;QACNmE,MAAI,CAACjD,MAAM,GAAG,KAAK;MACvB;IAAC;EACL;;;;;;;;;;;AArKS/D,oBAAoB,GAAAI,iDAAA,EAJhCK,wDAAS,CAAC;EACPuC,QAAQ,EAAE,kBAAkB;EAC5BC,QAAA,EAAAC,oEAAAA;CACH,CAAC,GACWlD,oBAAoB,CAsKhC","sources":["./src/app/profile/profile.module.ts","./src/app/profile/changepwd/changepwd.component.ts","./src/app/profile/profile.router.module.ts","./src/app/profile/profile-edit.component/profile-edit.component.ts"],"sourcesContent":["/* eslint-disable max-len */\nimport { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { IonicModule } from '@ionic/angular';\nimport { FormsModule, ReactiveFormsModule } from '@angular/forms';\nimport { CookieModule } from 'ngx-cookie';\n\nimport { ChangepwdComponent } from './changepwd/changepwd.component';\nimport { ProfileEditComponent } from './profile-edit.component/profile-edit.component';\n\nimport { GodigitalbModule } from 'godigital-lib';\n\nimport { ProfileRoutingModule } from './profile.router.module';\n\n@NgModule({\n  declarations: [ChangepwdComponent, ProfileEditComponent],\n  imports: [\n    CommonModule,\n    IonicModule,\n    ProfileRoutingModule,\n    FormsModule, ReactiveFormsModule,\n    CookieModule.forRoot(),\n    GodigitalbModule,\n  ],\n  providers:[]\n})\nexport class ProfileModule { }\n","import { Component, OnDestroy } from '@angular/core';\nimport { FormBuilder, FormGroup, Validators } from '@angular/forms';\nimport { Subscription } from 'rxjs';\nimport { UsersService } from 'godigital-lib';\n\n@Component({\n  selector: 'app-changepwd',\n  templateUrl: './changepwd.component.html'\n})\nexport class ChangepwdComponent implements OnDestroy {\n  sending = false;\n  success = false;\n  error?: string;\n  form: FormGroup;\n\n  private sub?: Subscription;\n  private uid?: string;\n  private email?: string;\n\n  constructor(private fb: FormBuilder, private users: UsersService) {\n    // Track current user\n    this.sub = this.users.authState$.subscribe(u => {\n      this.uid = u?.uid || undefined;\n      this.email = u?.email || undefined;\n    });\n    this.form = this.fb.group({\n      oldPassword: ['', [Validators.required, Validators.minLength(6)]],\n      newPassword: ['', [Validators.required, Validators.minLength(6)]],\n      confirm: ['', [Validators.required]]\n    });\n\n\n  }\n\n  ngOnDestroy(): void { this.sub?.unsubscribe(); }\n\n  async submit() {\n    this.error = undefined;\n    this.success = false;\n    if (this.form.invalid) return;\n\n    const { oldPassword, newPassword, confirm } = this.form.value;\n    if (newPassword !== confirm) {\n      this.error = 'New passwords do not match.';\n      return;\n    }\n    if (!this.uid || !this.email) {\n      this.error = 'You must be signed in to change your password.';\n      return;\n    }\n\n    // Minimal Users stub for updatePwd\n    const wnUser = { userId: this.uid, email: this.email } as any;\n\n    this.sending = true;\n    try {\n      await this.users.changePasswordWithOldPassword(oldPassword!, newPassword!);\n      this.success = true;\n      this.form.reset();\n    } catch (e: any) {\n      this.error = e?.message || 'Could not update password.';\n    } finally {\n      this.sending = false;\n    }\n  }\n\n  get f() { return this.form.controls; }\n}\n","\n\nimport { NgModule } from '@angular/core';\nimport { RouterModule, Routes } from '@angular/router';\n\nimport { ChangepwdComponent } from './changepwd/changepwd.component';\nimport { ProfileEditComponent } from './profile-edit.component/profile-edit.component';\n\nconst routes: Routes = [\n  { path: 'changepwd', component: ChangepwdComponent },\n  { path: 'profile-edit', component: ProfileEditComponent },\n];\n\n@NgModule({\n  imports: [\n    RouterModule.forChild(routes)\n  ],\n  exports: [RouterModule]\n})\nexport class ProfileRoutingModule { }\n","import { Component, OnDestroy } from '@angular/core';\nimport { FormArray, FormBuilder, FormGroup, Validators } from '@angular/forms';\nimport { Subscription } from 'rxjs';\nimport { StoreDbService, OBJECTNAME } from 'godigital-lib';\nimport { UsersService } from 'godigital-lib';\nimport { UtilsService } from 'godigital-lib';\n\ntype ProfileDoc = {\n    userId: string;\n    firstname?: string;\n    lastname?: string;\n    country?: string;\n    stripeAccountId?: string;\n    stripeAccountStatus?: string;\n    email: string;\n    phone?: string;\n    role: 'customer' | 'admin';\n    photos?: string[];\n    socialnetwork?: { label: string; url: string }[];\n    emailverified?: boolean;\n    state?: 'active' | 'disabled' | 'banned' | 'pending_review';\n    displayName?: string;\n    createdTS?: number;\n    modifiedTS?: number;\n    photoURL?: string;\n    provider?: string;\n};\n\n@Component({\n    selector: 'app-profile-edit',\n    templateUrl: './profile-edit.component.html'\n})\nexport class ProfileEditComponent implements OnDestroy {\n    loading = true;\n    saving = false;\n    error?: string;\n    success = false;\n    form: FormGroup;\n\n    uid?: string;\n    profile?: ProfileDoc;\n    sub?: Subscription;\n\n    photoUrls: string[] = [];\n\n    constructor(\n        private fb: FormBuilder,\n        private users: UsersService,\n        private storeDb: StoreDbService,\n        public utilSvc: UtilsService\n    ) {\n        this.sub = this.users.authState$.subscribe(async u => {\n            this.uid = u?.uid || undefined;\n            if (!this.uid) {\n                this.loading = false;\n                return;\n            }\n            await this.loadProfile();\n        });\n        this.form = this.fb.group({\n            firstname: ['', Validators.required],\n            lastname: ['', Validators.required],\n            displayName: [''],\n            phone: [''],\n            country: [''],\n            // role is shown but locked to customer here for security\n            role: [{ value: 'customer', disabled: true }],\n            state: ['active'], // optional to show; backend should enforce final state\n            socialnetwork: this.fb.array([] as any),\n        });\n\n\n    }\n\n    ngOnDestroy(): void { this.sub?.unsubscribe(); }\n\n    get socials() { return this.form.get('socialnetwork') as FormArray; }\n    newSocial(label = '', url = '') { return this.fb.group({ label: [label], url: [url] }); }\n\n    private async loadProfile() {\n        this.loading = true;\n        this.error = undefined;\n        try {\n            const doc = await this.storeDb.getObject(\n                this.utilSvc.backendFBstoreId,\n                this.utilSvc.mdb,\n                OBJECTNAME.bnUsers,\n                this.uid\n            ) as ProfileDoc | null;\n\n            this.profile = doc || undefined;\n\n            this.form.reset({\n                firstname: doc?.firstname || '',\n                lastname: doc?.lastname || '',\n                displayName: doc?.displayName || '',\n                phone: doc?.phone || '',\n                country: doc?.country || '',\n                role: 'customer',\n                state: doc?.state || 'active'\n            });\n\n            // socials\n            this.socials.clear();\n            (doc?.socialnetwork || []).forEach(s => this.socials.push(this.newSocial(s.label, s.url)));\n\n            // photos\n            this.photoUrls = (doc?.photos || []).slice();\n\n            this.loading = false;\n        } catch (e: any) {\n            this.error = e?.message || 'Failed to load profile';\n            this.loading = false;\n        }\n    }\n\n    addSocial() { this.socials.push(this.newSocial()); }\n    removeSocial(i: number) { this.socials.removeAt(i); }\n\n    async onPhotosSelected(files: FileList | null) {\n        if (!files?.length) return;\n        if (!this.uid) return;\n        this.saving = true;\n        try {\n            const dir = `users/${this.uid}`;\n            for (const file of Array.from(files)) {\n                const url = await this.storeDb.uploadObjects1(this.utilSvc.backendFBstoreId, file, dir) as string;\n                this.photoUrls.push(url);\n            }\n        } catch (e: any) {\n            this.error = e?.message || 'Photo upload failed';\n        } finally {\n            this.saving = false;\n        }\n    }\n\n    async save() {\n        this.error = undefined;\n        this.success = false;\n        if (!this.uid) return;\n\n        this.saving = true;\n        try {\n            const v = this.form.value;\n            const now = Date.now();\n\n            // Preserve immutable/sensitive fields from existing doc\n            const base: Partial<ProfileDoc> = this.profile || { userId: this.uid, email: '' } as any;\n\n            const payload: ProfileDoc = {\n                userId: this.uid,\n                email: base.email || '',\n\n                firstname: v.firstname || '',\n                lastname: v.lastname || '',\n                displayName: v.displayName || '',\n                phone: v.phone || '',\n                country: v.country || '',\n\n                // keep customer role client-side; admin must be server-side only\n                role: 'customer',\n\n                photos: this.photoUrls,\n                photoURL: this.photoUrls[0] || base.photoURL || '',\n\n                socialnetwork: (v.socialnetwork || []).map((s: any) => ({ label: s.label || '', url: s.url || '' })),\n\n                // leave verification and provider as previously stored\n                emailverified: base.emailverified ?? false,\n                provider: base.provider || 'firebase',\n\n                // allow user to set a visible \"state\" if you want, but enforce on server with rules\n                state: (v.state as any) || base.state || 'active',\n\n                // stripe fields preserved\n                stripeAccountId: base.stripeAccountId || '',\n                stripeAccountStatus: base.stripeAccountStatus || '',\n\n                createdTS: base.createdTS || now,\n                modifiedTS: now\n            };\n\n            await this.storeDb.updateObject(\n                this.utilSvc.backendFBstoreId,\n                this.utilSvc.mdb,\n                OBJECTNAME.bnUsers,\n                payload,\n                this.uid\n            );\n\n            this.profile = payload;\n            this.success = true;\n        } catch (e: any) {\n            this.error = e?.message || 'Failed to save profile';\n        } finally {\n            this.saving = false;\n        }\n    }\n}\n"],"names":["NgModule","CommonModule","IonicModule","FormsModule","ReactiveFormsModule","CookieModule","ChangepwdComponent","ProfileEditComponent","GodigitalbModule","ProfileRoutingModule","ProfileModule","__decorate","declarations","imports","forRoot","providers","Component","FormBuilder","Validators","UsersService","fb","users","sending","success","error","form","sub","uid","email","constructor","authState$","subscribe","u","undefined","group","oldPassword","required","minLength","newPassword","confirm","ngOnDestroy","unsubscribe","submit","_this","_asyncToGenerator","invalid","value","wnUser","userId","changePasswordWithOldPassword","reset","e","message","f","controls","selector","template","__NG_CLI_RESOURCE__0","RouterModule","routes","path","component","forChild","exports","StoreDbService","OBJECTNAME","UtilsService","storeDb","utilSvc","loading","saving","profile","photoUrls","_ref","loadProfile","_x","apply","arguments","firstname","lastname","displayName","phone","country","role","disabled","state","socialnetwork","array","socials","get","newSocial","label","url","_this2","doc","getObject","backendFBstoreId","mdb","bnUsers","clear","forEach","s","push","photos","slice","addSocial","removeSocial","i","removeAt","onPhotosSelected","files","_this3","length","dir","file","Array","from","uploadObjects1","save","_this4","v","now","Date","base","payload","photoURL","map","emailverified","provider","stripeAccountId","stripeAccountStatus","createdTS","modifiedTS","updateObject"],"sourceRoot":"webpack:///","x_google_ignoreList":[]}